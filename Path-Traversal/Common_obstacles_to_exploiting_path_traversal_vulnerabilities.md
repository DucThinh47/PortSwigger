# Common obstacles to exploiting path traversal vulnerabilities

Nhiều ứng dụng có cơ chế bảo vệ nhằm ngăn chặn các cuộc tấn công path traversal khi xử lý đầu vào của người dùng trong đường dẫn tệp. Tuy nhiên, những biện pháp này đôi khi có thể bị vượt qua.

Nếu ứng dụng loại bỏ hoặc chặn chuỗi path traversal (../) khỏi tên tệp do người dùng cung cấp, kẻ tấn công vẫn có thể tìm cách lách qua bằng nhiều kỹ thuật khác nhau.

Một trong những cách phổ biến là sử dụng đường dẫn tuyệt đối từ thư mục gốc của hệ thống, chẳng hạn như:

    filename=/etc/passwd

Với cách này, kẻ tấn công có thể truy cập trực tiếp vào tệp mong muốn mà không cần sử dụng chuỗi ../ để di chuyển giữa các thư mục.

# Lab: File path traversal, traversal sequences blocked with absolute path bypass

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image7.png?raw=true)

Truy cập website:

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image8.png?raw=true)

Chọn 1 hình ảnh chi tiết của 1 sản phẩm và Intercept request này trong Burp Suite: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image9.png?raw=true)

Thử thay giá trị tham số filename thành /../../../etc/passwd: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image10.png?raw=true)

Có thể website đã lọc các ký tự ../, thử thay thành đường dẫn trực tiếp /etc/passwd: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image11.png?raw=true)

=> Đọc được nội dung file /etc/passwd.

Solved the lab!

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image12.png?raw=true)

# Common obstacles to exploiting path traversal vulnerabilities - Continued

Kẻ tấn công có thể lợi dụng các chuỗi path traversal lồng nhau, chẳng hạn như:

    ....// hoặc ....\/

Nếu ứng dụng chỉ loại bỏ chuỗi ../ nhưng không xử lý đúng cách các chuỗi mở rộng này, chúng có thể tự động rút gọn thành chuỗi path traversal hợp lệ, giúp kẻ tấn công vượt qua cơ chế bảo vệ.

# Lab: File path traversal, traversal sequences stripped non-recursively

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image13.png?raw=true)

Truy cập website: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image14.png?raw=true)

Chọn xem chi tiết một hình ảnh của 1 sản phẩm và Intercept request này trong Burp Suite: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image15.png?raw=true)

Thử thay giá trị tham số filename thành /../../../etc/passwd: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image16.png?raw=true)

Không xem được, có thể website đã lọc ký tự ../, thử giá trị /etc/passwd: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image17.png?raw=true)

Cũng không được, thử giá trị ....//....//....//etc/passwd:

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image18.png?raw=true)

Solved the lab!

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image19.png?raw=true)

# Common obstacles to exploiting path traversal vulnerabilities - Continued

Trong một số trường hợp, chẳng hạn như khi đường dẫn nằm trong URL hoặc tham số filename của yêu cầu multipart/form-data, máy chủ web có thể tự động loại bỏ các chuỗi path traversal (../) trước khi truyền đầu vào đến ứng dụng.

Để vượt qua cơ chế này, kẻ tấn công có thể sử dụng mã hóa URL hoặc thậm chí mã hóa URL hai lần để che giấu chuỗi ../. Ví dụ:

- Mã hóa URL: ../ → %2e%2e%2f

- Mã hóa URL hai lần: ../ → %252e%252e%252f

Ngoài ra, các kỹ thuật mã hóa không tiêu chuẩn cũng có thể hoạt động, chẳng hạn như:

- ..%c0%af

- ..%ef%bc%8f

# Lab: File path traversal, traversal sequences stripped with superfluous URL-decode

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image20.png?raw=true)

Truy cập website: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image21.png?raw=true)

Chọn xem chi tiết một hình ảnh của 1 sản phẩm và Intercept request này trong Burp Suite: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image22.png?raw=true)

Thử thay giá trị tham số filename thành ../../../etc/passwd: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image23.png?raw=true)

Không được, thử ....//....//....//etc/passwd: 

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image24.png?raw=true)

Không được, thử mã hóa payload này thành ..%252f..%252f..%252fetc/passwd:

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image25.png?raw=true)

=> Đọc thành công file /etc/passwd.

Solved the lab!

![img](https://github.com/DucThinh47/PortSwigger/blob/main/Path-Traversal/images/image26.png?raw=true)

# Common obstacles to exploiting path traversal vulnerabilities - Continued

Một số ứng dụng yêu cầu tên tệp do người dùng cung cấp phải bắt đầu bằng một thư mục cơ sở cố định, chẳng hạn như:

    /var/www/images

Trong trường hợp này, kẻ tấn công có thể chèn thư mục cơ sở bắt buộc vào đầu chuỗi, sau đó thêm các chuỗi path traversal thích hợp để vượt qua hạn chế. Ví dụ:

    filename=/var/www/images/../../../etc/passwd

# Lab: File path traversal, validation of start of path

![img](27)

Truy cập website: 

![img](28)

Chọn xem chi tiết một hình ảnh của 1 sản phẩm và Intercept request này trong Burp Suite: 

![img](29)

Thử chèn giá trị tham số filename thành /var/www/images/../../../etc/passwd: 

![img](30)

=> Xem file /etc/passwd thành công.

Solved the lab!

![img](31)

